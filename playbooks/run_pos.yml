---
# ------------------------------------------------------------
#  FIX : Load hostvars for ran_node and faraday
#  Without this, hostvars[...] are EMPTY when using -c local 
# ------------------------------------------------------------
- name: Load inventory hostvars needed by POS role
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Ensure hostvars for ran_node and faraday are loaded
      add_host:
        name: "{{ item }}"
      loop: >
        {{ (groups['ran_node'] | default([])) +
           (groups['faraday'] | default([])) }}

# ------------------------------------------------------------
#  Run POS on one node
# ------------------------------------------------------------
- name: Run POS for selected node
  hosts: webshell
  gather_facts: no
  vars:
    target_node: "{{ node }}"
  tasks:
    - name: Prepare pos vars for node {{ target_node }}
      set_fact:
        node: "{{ target_node }}"

    - name: Run POS role on {{ target_node }}
      include_role:
        name: pos
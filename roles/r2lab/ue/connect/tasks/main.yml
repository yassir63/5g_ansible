---
# ue_item stands for the UE name, defined in the inventory

- name: Load active 5G profile variables
  ansible.builtin.include_vars:
    file: "{{ playbook_dir }}/../group_vars/all/5g_profile_{{ fiveg_profile | default('default') }}.yaml"

- name: Extract UE configuration
  set_fact:
    current_ue_slice: "{{ ues[ue_item].slice }}"
  when: ues[ue_item] is defined

- name: Extract DNN for slice
  set_fact:
    current_dnn: "{{ (slices | selectattr('name', 'equalto', current_ue_slice) | map(attribute='dnn') | first) }}"
  when: current_ue_slice is defined

- name: Start UE via jump host
  shell: "ssh root@{{ ue_item }} 'start.sh -F {{ current_dnn }}'"
  when: current_dnn is defined
  ignore_errors: "{{ ignore_errors | default(false) }}"
